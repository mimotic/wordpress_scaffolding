(globalThis.itsecWebpackJsonP=globalThis.itsecWebpackJsonP||[]).push([[830],{60556:(e,t,n)=>{"use strict";n.r(t);var i=n(6293),a=n(95122),s=n(3571),r=n(92819),l=n(87514),o=n.n(l),c=n(48015),u=n(91991),m=n(7980),d=n(50460),p=n(31600),h=n(16550),g=n(19144);function f(e){let{asyncNotifications:t,asyncUsersAndRoles:n}=e;const{url:s,path:l}=(0,h.$B)(),{root:o}=(0,h.UO)(),{goNext:u}=(0,m.useNavigation)(),{status:d,value:g}=t,{status:f,value:E}=n,v=(0,c.useSelect)((e=>e(p.MODULES_STORE_NAME).getError("notification-center")),[]),{saveSettings:b}=(0,c.useDispatch)(p.MODULES_STORE_NAME);if("success"!==d&&("pending"!==d||!g)||"success"!==f)return null;const S="settings"===o?()=>b("notification-center"):u,y="settings"===o?void 0:(0,a.__)("Continue","better-wp-security"),N="settings"!==o;if("onboard"===o)return(0,i.createElement)(R,{usersAndRoles:E,onSubmit:S,saveLabel:y,allowUndo:!1,allowCleanSave:N,apiError:v});const O=(0,i.createElement)(m.ChildPages,{pages:(0,r.map)(g,(e=>({title:e.l10n.label,to:`${s}/${e.slug}`,id:e.slug})))});return(0,i.createElement)(h.rs,null,(0,i.createElement)(h.AW,{path:`${l}/:child`},O,(0,i.createElement)(_,{notifications:g,usersAndRoles:E,apiError:v,onSubmit:S,saveLabel:y,allowCleanSave:N})),(0,i.createElement)(h.AW,{path:l},O,(0,i.createElement)(R,{usersAndRoles:E,onSubmit:S,apiError:v,saveLabel:y,allowCleanSave:N})))}function _(e){let{notifications:t,usersAndRoles:n,apiError:a,onSubmit:s,saveLabel:r,allowCleanSave:l}=e;const{child:o}=(0,h.UO)(),{isDirty:u,isSaving:m,settings:d}=(0,c.useSelect)((e=>({isDirty:e(p.MODULES_STORE_NAME).areSettingsDirty("notification-center"),isSaving:e(p.MODULES_STORE_NAME).isSavingSettings("notification-center"),settings:e(p.MODULES_STORE_NAME).getEditedSetting("notification-center","notifications")})),[]),{editSetting:g,resetSettingEdits:f}=(0,c.useDispatch)(p.MODULES_STORE_NAME),_=(0,i.useCallback)((e=>g("notification-center","notifications",{...d,[o]:e})),[o,g,d]);return d?(0,i.createElement)(React.Fragment,null,(0,i.createElement)(E,{notification:o}),(0,i.createElement)(y,{notification:t[o],usersAndRoles:n,settings:d[o]||{},onChange:_,isSaving:m,isDirty:u,onSubmit:s,onUndo:()=>f("notification-center"),saveLabel:r,allowCleanSave:l,apiError:a})):null}function E(e){let{notification:t}=e;const n=(0,h.$B)();return(0,i.createElement)(m.HelpFill,null,(0,i.createElement)(m.PageHeader,{title:(0,a.__)("Notifications","better-wp-security"),breadcrumbs:(0,i.createElement)(m.Breadcrumbs,{match:n,title:(0,a.__)("Help","better-wp-security")})}),(0,i.createElement)(g.ss,{topic:`notification-center-${t}`,fallback:"notification-center"}))}var v=n(64893),b=n(9576);const S=["a","i","b","h2","h3","h4","h5","h6","p"];function y(e){let{notification:t,settings:n,onChange:s,usersAndRoles:r,isSaving:l,isDirty:o,onSubmit:c,onUndo:u,saveLabel:d=(0,a.__)("Save All","better-wp-security"),allowCleanSave:p=!1,apiError:h}=e;const g=!t.optional||n.enabled;return(0,i.createElement)(React.Fragment,null,(0,i.createElement)(m.PageHeader,{title:t.l10n.label,description:t.l10n.description}),(0,i.createElement)(m.PrimaryForm,{saveLabel:d,saveDisabled:!o&&!p,isSaving:l,onSubmit:c,apiError:h,buttons:[(0,i.createElement)(v.Button,{key:"undo",onClick:u,disabled:!o},(0,a.__)("Undo Changes","better-wp-security"))]},t.optional&&(0,i.createElement)(v.CheckboxControl,{className:"itsec-nc-notification__enabled",label:(0,a.__)("Enabled","better-wp-security"),checked:n.enabled,onChange:e=>s({...n,enabled:e})}),g&&(0,i.createElement)(React.Fragment,null,(0,i.createElement)(N,{notification:t,settings:n,onChange:s}),(0,i.createElement)(O,{notification:t,settings:n,onChange:s}),(0,i.createElement)(w,{notification:t,settings:n,onChange:s,usersAndRoles:r}))))}function N(e){let{notification:t,settings:n,onChange:s}=e;const l=(0,i.createElement)("span",null,(0,a.sprintf)((0,a.__)("You can use HTML in your message. Allowed HTML includes: %s.","better-wp-security"),S.join(", "))," ",!!t.tags&&(0,i.createInterpolateElement)((0,a.__)("This notification supports email tags. Tags are formatted as follows <tag />.","better-wp-security"),{tag:(0,i.createElement)("code",null,"{{ $tag_name }}")}));return(0,i.createElement)(m.PrimaryFormSection,{heading:(0,a.__)("Customize","better-wp-security")},t.subject_editable&&(0,i.createElement)(v.TextControl,{label:(0,a.__)("Subject","better-wp-security"),placeholder:t.l10n.subject,value:n.subject||t.l10n.subject,onChange:e=>s({...n,subject:e})}),t.message_editable&&(0,i.createElement)(React.Fragment,null,(0,i.createElement)(v.TextareaControl,{label:(0,a.__)("Message","better-wp-security"),placeholder:t.l10n.message,rows:10,value:n.message||t.l10n.message,onChange:e=>s({...n,message:e}),help:l}),t.tags&&(0,i.createElement)("dl",null,(0,r.map)(t.l10n.tags,((e,t)=>(0,i.createElement)(i.Fragment,{key:t},(0,i.createElement)("dt",null,(0,i.createElement)("code",null,t)),(0,i.createElement)("dd",null,e)))))))}function O(e){let{notification:t,settings:n,onChange:s}=e;const l=(0,b.useInstanceId)(w,"itsec-nc-notification__schedule");return(0,r.isPlainObject)(t.schedule)?(0,i.createElement)(m.PrimaryFormSection,{heading:(0,i.createElement)("label",{htmlFor:l},(0,a.__)("Schedule","better-wp-security"))},(0,i.createElement)(v.SelectControl,{id:l,options:t.l10n.schedule,value:n.schedule,onChange:e=>s({...n,schedule:e})})):null}function w(e){let{notification:t,settings:n,onChange:s,usersAndRoles:r}=e;const l=(0,b.useInstanceId)(w,"itsec-nc-notification__recipients");switch(t.recipient){case"user":return(0,i.createElement)(m.PrimaryFormSection,{className:"itsec-nc-notification__recipients",heading:(0,a.__)("Recipient","better-wp-security")},(0,a.__)("Site Users","better-wp-security"));case"admin":return(0,i.createElement)(m.PrimaryFormSection,{className:"itsec-nc-notification__recipients",heading:(0,a.__)("Recipient","better-wp-security")},(0,a.__)("Admin Emails","better-wp-security"));case"per-use":return(0,i.createElement)(m.PrimaryFormSection,{className:"itsec-nc-notification__recipients",heading:(0,a.__)("Recipient","better-wp-security")},(0,a.__)("Specified when sending","better-wp-security"));case"email-list":return(0,i.createElement)(m.PrimaryFormSection,{heading:(0,i.createElement)("label",{htmlFor:l},(0,a.__)("Recipient","better-wp-security"))},(0,i.createElement)(g.yA,{id:l,help:(0,a.__)("The email address(es) this notification will be sent to. One address per line.","better-wp-security"),value:n.email_list,onChange:e=>s({...n,email_list:e})}));case"user-list":return(0,i.createElement)(m.PrimaryFormSection,{className:"itsec-nc-notification__recipients itsec-nc-notification__recipients--user-list",heading:(0,i.createElement)("label",{htmlFor:l},(0,a.__)("Recipient","better-wp-security"))},(0,i.createElement)(v.SelectControl,{value:n.recipient_type,onChange:e=>s({...n,recipient_type:e}),id:l,options:[{value:"default",label:(0,a.__)("Default Recipients","better-wp-security")},{value:"custom",label:(0,a.__)("Custom","better-wp-security")}]}),"custom"===n.recipient_type&&(0,i.createElement)(L,{help:(0,a.__)("Select which users should be emailed.","better-wp-security"),value:n.user_list||[],onChange:e=>s({...n,user_list:e}),usersAndRoles:r}))}}function R(e){let{usersAndRoles:t,onSubmit:n,saveLabel:s=(0,a.__)("Save All","better-wp-security"),allowUndo:r=!0,allowCleanSave:l=!1,apiError:o}=e;const u=(0,m.useModuleSchemaValidator)("notification-center"),[d,h]=(0,i.useState)([]),{isDirty:f,isSaving:_,fromEmail:E,defaultRecipients:b}=(0,c.useSelect)((e=>({isDirty:e(p.MODULES_STORE_NAME).areSettingsDirty("notification-center"),isSaving:e(p.MODULES_STORE_NAME).isSavingSettings("notification-center"),fromEmail:e(p.MODULES_STORE_NAME).getEditedSetting("notification-center","from_email")||"",defaultRecipients:e(p.MODULES_STORE_NAME).getEditedSetting("notification-center","default_recipients")||{}})),[]),{editSetting:S,resetSettingEdits:y}=(0,c.useDispatch)(p.MODULES_STORE_NAME);return(0,i.createElement)(React.Fragment,null,(0,i.createElement)(m.PageHeader,{title:(0,a.__)("Notification Center","better-wp-security"),description:(0,a.__)("Manage and configure email notifications sent by iThemes Security related to various settings modules.","better-wp-security")}),(0,i.createElement)(m.PrimaryForm,{saveLabel:s,saveDisabled:!f&&!l,isSaving:_,onSubmit:()=>{const e=u();!0===e?(h([]),n()):h(e.errorText)},apiError:o,errors:d,buttons:r&&[(0,i.createElement)(v.Button,{key:"undo",onClick:()=>y("notification-center"),disabled:!f},(0,a.__)("Undo Changes","better-wp-security"))]},(0,i.createElement)(v.TextControl,{type:"email",value:E,onChange:e=>S("notification-center","from_email",e),label:(0,a.__)("From Email","better-wp-security"),help:(0,a.__)("iThemes Security will send notifications from this email address. Leave blank to use the WordPress default.","better-wp-security")}),(0,i.createElement)(m.PrimaryFormSection,{heading:(0,a.__)("Default Recipients")},(0,i.createElement)(L,{help:(0,a.__)("Set the default recipients for any admin-facing notifications.","better-wp-security"),value:b.user_list||[],onChange:e=>S("notification-center","default_recipients",{...b,user_list:e}),usersAndRoles:t}))),(0,i.createElement)(m.HelpFill,null,(0,i.createElement)(m.PageHeader,{title:(0,a.__)("Notifications","better-wp-security")}),(0,i.createElement)(g.ss,{topic:"notification-center"})))}function L(e){let{value:t,onChange:n,usersAndRoles:s,help:r}=e;return(0,i.createElement)("fieldset",{className:"itsec-nc-user-role-list"},r&&(0,i.createElement)("legend",null,r),(0,i.createElement)("ul",{className:"itsec-nc-user-role-list__group"},s.roles.map((e=>{let{value:s,label:r}=e;return(0,i.createElement)("li",{key:s},(0,i.createElement)(v.CheckboxControl,{label:(0,a.sprintf)((0,a.__)("All “%s” Users","better-wp-security"),r),checked:t.includes(s),onChange:e=>n(e?[...t,s]:t.filter((e=>e!==s)))}))}))),(0,i.createElement)("ul",{className:"itsec-nc-user-role-list__group"},s.users.map((e=>{let{value:a,label:s}=e;return(0,i.createElement)("li",{key:a},(0,i.createElement)(v.CheckboxControl,{label:s,checked:t.includes(a),onChange:e=>n(e?[...t,a]:t.filter((e=>e!==a)))}))}))))}const C=()=>o()({path:"/ithemes-security/rpc/notification-center/available-users-roles"});function I(){const e=(0,c.useSelect)((e=>e(p.MODULES_STORE_NAME).getActiveModules())),t=(0,u.r5)((0,i.useCallback)((()=>o()({path:"/ithemes-security/rpc/notification-center/notifications"})),[e])),n=(0,u.r5)(C);return function(e){const{registerProvider:t}=(0,c.useDispatch)(d.G);(0,i.useEffect)((()=>{t("notifications",(0,a.__)("Notifications","better-wp-security"),50,(t=>{let{evaluate:n,results:i}=t;return(0,r.reduce)(e,((e,t,a)=>n.stringMatch(t.l10n.label)||n.stringMatch(t.l10n.description)?(i.items.push({title:t.l10n.label,description:t.l10n.description,route:`/settings/notification-center/${a}`}),e++):e),0)}))}),[e])}(t.value),(0,i.createElement)(m.Page,{id:"notification-center",title:(0,a.__)("Notifications","better-wp-security"),icon:"email-alt",priority:20,roots:["onboard","import","settings"],key:t.status+n.status},(()=>(0,i.createElement)(f,{asyncNotifications:t,asyncUsersAndRoles:n})))}n.p=window.itsecWebpackPublicPath,(0,a.setLocaleData)({"":{}},"ithemes-security-pro"),(0,s.registerPlugin)("itsec-notification-center-settings",{render:()=>(0,i.createElement)(I,null)})},50460:(e,t,n)=>{"use strict";n.d(t,{G:()=>F,o:()=>I});var i={};n.r(i),n.d(i,{REGISTER_PROVIDER:()=>P,registerProvider:()=>A});var a={};n.r(a),n.d(a,{getProviders:()=>T});var s=n(87462),r=n(6293),l=n(73727),o=n(16550),c=n(90071),u=n(92819),m=n(64893),d=n(95122),p=n(48015),h=n(9576),g=n(81019),f=n(82839),_=n(78363),E=n(91991),v=n(19144),b=n(86033),S=n(13092);function y(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}var N=new WeakMap,O=new WeakMap,w=new WeakMap,R=new WeakMap,L=new WeakMap;class C{constructor(e,t){y(this,N,{writable:!0,value:void 0}),y(this,O,{writable:!0,value:void 0}),y(this,w,{writable:!0,value:void 0}),y(this,R,{writable:!0,value:void 0}),y(this,L,{writable:!0,value:void 0}),(0,S.Z)(this,N,e),(0,S.Z)(this,O,t),(0,S.Z)(this,w,t.select(F).getProviders()),this._prepare()}_prepare(){(0,S.Z)(this,L,(0,b.Z)(this,N).split(/\s+/g).map((e=>e.trim().toLowerCase())).filter((e=>!!e)));const e=(0,b.Z)(this,N).endsWith(" ");(0,S.Z)(this,R,new RegExp((0,b.Z)(this,L).map(((t,n)=>n+1!==(0,b.Z)(this,L).length||e?`(?=.*\\b${(0,u.escapeRegExp)(t)}\\b)`:`(?=.*\\b${(0,u.escapeRegExp)(t)})`)).join("")+".+","gi"))}_stringMatch(e){return e&&(0,b.Z)(this,R).test(e)}_keywordMatch(e){return!(!e||!e.length)&&e.some((e=>(0,b.Z)(this,L).some(((t,n)=>e.includes(" ")?this._stringMatch(e):n===(0,b.Z)(this,L).length-1?e.startsWith(t):t===e))))}getResults(){if((0,b.Z)(this,N).length<3)return[{},0];let e=0;const t=[],n={stringMatch:e=>this._stringMatch(e),keywordMatch:e=>this._keywordMatch(e)};for(const i of(0,b.Z)(this,w)){const a={title:i.title,items:[],groups:{}};e+=i.callback({evaluate:n,results:a,registry:(0,b.Z)(this,O)}),!a.items.length&&(0,u.isEmpty)(a.groups)||t.push(a)}return[t,e]}}const I=(0,r.forwardRef)((function(e,t){let{onPick:n=u.noop,showResults:i}=e;const[a,l]=(0,r.useState)(""),[o,c]=(0,r.useState)(!1),m=(0,r.useRef)(),v=(0,r.useRef)(),[b,S]=(0,r.useState)([]),y=(0,p.useRegistry)(),N=(0,r.useCallback)((e=>{const t=new C(e,y).getResults();S(t[0]),(0,f.speak)((0,d.sprintf)((0,d._n)("%d result found.","%d results found.",t[1],"better-wp-security"),t[1]))}),[y]),O=(0,h.useDebounce)(N,50),w=(0,r.useCallback)((e=>{m.current&&(e.preventDefault(),m.current.focus())}),[m]);return(0,h.useKeyboardShortcut)("/",w),(0,r.createElement)("div",(0,s.Z)({className:"itsec-search"},(0,E.Zk)((()=>c(!1)))),(0,r.createElement)("div",null,(0,r.createElement)(_.lD,{value:a,onChange:e=>{l(e),O(e)},onFocus:()=>c(!0),onKeyDown:e=>{e.keyCode===g.DOWN&&(e.preventDefault(),v.current.focus())},ref:(0,E.qq)([t,m]),placeholder:(0,d.__)("Search for feature, settings, and more","better-wp-security"),omitSeparators:!0}),(o||i)&&a.length>=3&&(0,r.createElement)(k,{results:b,exitSearch:e=>{n(e),c(!1)},ref:v,onPick:n})))})),k=(0,r.forwardRef)((function(e,t){let{results:n,exitSearch:i,onPick:a}=e;const l=(0,r.useRef)();(0,r.useImperativeHandle)(t,(()=>({focus(){l.current.focus()}})));const p=(0,h.useInstanceId)(k,"itsec-search"),f=p+"__result__",_=function(){const e=(0,o.k6)();return function(t){return e[arguments.length>1&&void 0!==arguments[1]?arguments[1]:"push"]((0,c.ob)(t))}}(),[E,b]=(0,r.useState)("");return(0,u.isEmpty)(n)?null:(0,r.createElement)(React.Fragment,null,(0,r.createElement)(m.VisuallyHidden,{id:p+"__label"},(0,d.__)("Search Results","better-wp-security")),(0,r.createElement)(v.T2,{className:"itsec-search__results",id:p,active:E&&f+E,onNavigate:e=>b(e.substr(f.length)),onKeyDown:e=>{let{keyCode:t}=e;!E||t!==g.ENTER&&t!==g.SPACE||(a(E),_(E),i())},onFocus:()=>{if(!E&&!(0,u.isEmpty)(n)){const[,e]=Object.entries(n)[0];if(e.items?.length)b(e.items[0].route);else if(!(0,u.isEmpty)(e.groups)){const[,t]=Object.entries(e.groups)[0];b(t.items[0].route)}}},role:"listbox",descendantRoles:"option",ref:l,"aria-labelledby":p+"__label"},(0,u.map)(n,((e,t)=>(0,r.createElement)(M,(0,s.Z)({key:t},e,{active:E,idPrefix:f,exitSearch:i}))))))}));function M(e){let{title:t,items:n,groups:i,...a}=e;const l=(0,h.useInstanceId)(k,"itsec-search__kind");return(0,r.createElement)("ul",{className:"itsec-search__kind",role:"group","aria-labelledby":l},(0,r.createElement)("li",{role:"presentation",id:l},t),(n||[]).map((e=>(0,r.createElement)(x,(0,s.Z)({key:e.route},e,a)))),(0,u.map)(i,((e,t)=>(0,r.createElement)(D,(0,s.Z)({key:t},e,a)))))}function D(e){let{title:t,items:n,...i}=e;const a=(0,h.useInstanceId)(k,"itsec-search__group");return(0,r.createElement)("ul",{className:"itsec-search__group",role:"group","aria-labelledby":a},(0,r.createElement)("li",{role:"presentation",id:a},(0,r.createElement)("span",null,t)),(n||[]).map((e=>(0,r.createElement)(x,(0,s.Z)({key:e.route},e,i)))))}function x(e){let{title:t,description:n,route:i,active:a,idPrefix:s,exitSearch:o}=e;return(0,r.createElement)("li",{className:"itsec-search__result",role:"option","aria-selected":a===i||void 0,id:s+i,"aria-label":t},(0,r.createElement)(l.rU,{to:i,tabIndex:-1,onClick:()=>o(i)},(0,r.createElement)("span",null,t),(0,r.createElement)(v.Lu,{content:n,noHtml:!0,tagName:"p"})))}function A(e,t,n,i){return{type:P,slug:e,title:t,priority:n,callback:i}}const P="REGISTER_PROVIDER",T=(0,n(28306).Z)((e=>(0,u.sortBy)(e.providers,"priority")),(e=>e.providers)),U={providers:{}},F="ithemes-security/search";(0,p.registerStore)(F,{actions:i,selectors:a,reducer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;return t.type===P?{...e,providers:{...e.providers,[t.slug]:(0,u.omit)(t,["type"])}}:e}})},28306:(e,t,n)=>{"use strict";var i,a;function s(e){return[e]}function r(){var e={clear:function(){e.head=null}};return e}function l(e,t,n){var i;if(e.length!==t.length)return!1;for(i=n;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function o(e,t){var n,o;function c(){n=a?new WeakMap:r()}function u(){var n,i,a,s,r,c=arguments.length;for(s=new Array(c),a=0;a<c;a++)s[a]=arguments[a];for(r=t.apply(null,s),(n=o(r)).isUniqueByDependants||(n.lastDependants&&!l(r,n.lastDependants,0)&&n.clear(),n.lastDependants=r),i=n.head;i;){if(l(i.args,s,1))return i!==n.head&&(i.prev.next=i.next,i.next&&(i.next.prev=i.prev),i.next=n.head,i.prev=null,n.head.prev=i,n.head=i),i.val;i=i.next}return i={val:e.apply(null,s)},s[0]=null,i.args=s,n.head&&(n.head.prev=i,i.next=n.head),n.head=i,i.val}return t||(t=s),o=a?function(e){var t,a,s,l,o,c=n,u=!0;for(t=0;t<e.length;t++){if(!(o=a=e[t])||"object"!=typeof o){u=!1;break}c.has(a)?c=c.get(a):(s=new WeakMap,c.set(a,s),c=s)}return c.has(i)||((l=r()).isUniqueByDependants=u,c.set(i,l)),c.get(i)}:function(){return n},u.getDependants=t,u.clear=c,c(),u}n.d(t,{Z:()=>o}),i={},a="undefined"!=typeof WeakMap},31600:e=>{e.exports=function(){return this.itsec.packages.data}()},7980:e=>{e.exports=function(){return this.itsec.pages.settings}()},82839:e=>{e.exports=function(){return this.wp.a11y}()},87514:e=>{e.exports=function(){return this.wp.apiFetch}()},64893:e=>{e.exports=function(){return this.wp.components}()},9576:e=>{e.exports=function(){return this.wp.compose}()},48015:e=>{e.exports=function(){return this.wp.data}()},6293:e=>{e.exports=function(){return this.wp.element}()},95122:e=>{e.exports=function(){return this.wp.i18n}()},81834:e=>{e.exports=function(){return this.wp.isShallowEqual}()},81019:e=>{e.exports=function(){return this.wp.keycodes}()},3571:e=>{e.exports=function(){return this.wp.plugins}()},14776:e=>{e.exports=function(){return this.wp.primitives}()},73470:e=>{e.exports=function(){return this.wp.url}()},99196:e=>{"use strict";e.exports=window.React},91850:e=>{"use strict";e.exports=window.ReactDOM},92819:e=>{"use strict";e.exports=window.lodash}},e=>{e.O(0,[271,655,363,991,144],(()=>(60556,e(e.s=60556))));var t=e.O();((window.itsec=window.itsec||{})["notification-center"]=window.itsec["notification-center"]||{}).settings=t}]);